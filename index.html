<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Quick ISBN book cover lookup tool">
  <title>My Little Library</title>
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAhJJREFUWEftl79rFEEcxd/7ZmMhiKKFhdhaa2HrD0ih/4CNRbCwEAsbQYJ6M3te0gkWFhYiNhYiFlZWFjYKYmEhCAELOyH+A0GwEBTh9mbeOgN7t3vZ7N2eiQiXNHM77z7v+z7mG0L/+NAf50cCqBPwqRXDN8ZGwCfMBmB4bM0KMGO4KQCTPM+niqI4XJblPWZ+RkSziHgDEZ8j4joiPmDmFSJ6g4gbRLQK4DoA9u8B8DsAvAewAGAeEc8CwAUiWmPmj0qpGSKaIqJ3zPyTiG4h4m0AP5j5KxHdBYA5IjoP4BIRrQN4iYgLAE4DuEJEHxDxBRFdBXAKwBUiegrgGSLeAHASwHVEfA7gCSKKmHkwAStpmk6WZbmtlNoGgHVm3kTE+wBwBxF/MfM6ET1CxLsAkDPzFyJ6kOf5dJ7n+wHsCoLgMADsY+aDQohJKeU4Ih5BxAkppQghxoQQB6SUY1LKCSGEEEIcklKOSyn3SSn3CiH2CCF2SymHXeaHMiEzKxNqrSOl1IRSqqW1ntBaj2utW1rrltZaaa2V1lpqrUOtdai1DvXvCfXvZzBKxUcmjON4IcuyG1mWnc+y7FSWZSeyLDuWZdl4lmVRlmUtpVSolAqVUoFSKiyKIiiKws/zfCjAyBP8CwC89QHwi3Zw6PZtB7gI3HpwUXDx6Pp+G6BvglFc8D8AGDnEPQe4R7mnXP0E+gUYKQU/AX4DxhVC6BsnwDYAAAAASUVORK5CYII=">
  <style>
    /* Reset and base styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f5f5f5;
    }

    /* Layout and containers */
    .container {
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      text-align: center;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    /* Typography */
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 2em;
    }

    /* Form elements */
    #isbnInput {
      width: 100%;
      max-width: 300px;
      padding: 12px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    #isbnInput:focus {
      outline: none;
      border-color: #3498db;
    }

    .image-container {
      position: relative;
      min-height: 200px;
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #bookCover {
      max-width: 300px;
      width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      display: block;
      margin: 0 auto;
    }

    #bookCover:hover {
      transform: scale(1.02);
    }

    .book-info {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
      display: none;
    }

    .book-info h2 {
      color: #2c3e50;
      font-size: 1.4em;
      margin-bottom: 10px;
    }

    .book-info p {
      color: #666;
      margin: 5px 0;
      font-size: 1.1em;
    }

    .spinner {
      display: none;
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      position: absolute;
      top: 50%;
      left: 50%;
      margin: -25px 0 0 -25px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>My Little Library</h1>
    <input type="text" id="isbnInput" placeholder="Scan ISBN or type number" autocomplete="off">
    <div class="image-container">
      <div class="spinner" id="loadingSpinner"></div>
      <img id="bookCover" src="" alt="Book cover will appear here">
    </div>
    <div class="book-info" id="bookInfo">
      <h2 id="bookTitle">_</h2>
      <p>By <span id="bookAuthor"></span></p>
      <p>Published: <span id="bookDate"></span></p>
    </div>
    <div id="errorMessage" style="color: #e74c3c; margin-top: 10px; display: none;"></div>
  </div>
  <script>
    // Constants
    const DEFAULT_COVER = 'data:image/svg+xml,' + encodeURIComponent(`
      <svg width="200" height="300" xmlns="http://www.w3.org/2000/svg">
        <rect width="200" height="300" fill="#f8f9fa"/>
        <rect width="180" height="280" x="10" y="10" fill="#fff" stroke="#ddd" stroke-width="2"/>
        <text x="100" y="150" font-family="system-ui" font-size="16" fill="#666" text-anchor="middle">No Cover Found</text>
      </svg>
    `);

    // Cache DOM elements
    const elements = {
      input: document.getElementById('isbnInput'),
      coverImg: document.getElementById('bookCover'),
      spinner: document.getElementById('loadingSpinner'),
      errorMessage: document.getElementById('errorMessage'),
      bookInfo: document.getElementById('bookInfo'),
      bookTitle: document.getElementById('bookTitle'),
      bookAuthor: document.getElementById('bookAuthor'),
      bookDate: document.getElementById('bookDate')
    };

    // Utility functions
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), wait);
      };
    }

    function showError(message) {
      elements.spinner.style.display = 'none';
      elements.errorMessage.textContent = message;
      elements.errorMessage.style.display = 'block';
      elements.input.focus();
      elements.input.select();
    }

    function hideError() {
      elements.errorMessage.style.display = 'none';
    }

    function showSpinner() {
      elements.spinner.style.display = 'block';
      elements.coverImg.style.display = 'none';
    }

    function hideSpinner() {
      elements.spinner.style.display = 'none';
    }

    function validateISBN(isbn) {
      return /^(\d{10}|\d{13})$/.test(isbn);
    }

    function resetUI() {
      hideError();
      elements.bookInfo.style.display = 'none';
      elements.input.focus();
      elements.input.select();
    }

    // Book data functions
    async function fetchBookMetadata(isbn) {
      try {
        const response = await fetch(
          `https://openlibrary.org/api/books?bibkeys=ISBN:${isbn}&format=json&jscmd=data`
        );
        const data = await response.json();
        console.log('Book metadata response:', data);
        return data[`ISBN:${isbn}`];
      } catch (error) {
        console.error('Error fetching book data:', error);
        return null;
      }
    }

    function updateBookInfo(bookData) {
      if (!bookData) return;

      elements.bookTitle.textContent = bookData.title || 'Unknown Title';
      elements.bookAuthor.textContent =
        bookData.authors ? bookData.authors.map(a => a.name).join(', ') : 'Unknown Author';
      elements.bookDate.textContent = bookData.publish_date || 'Unknown Date';
      elements.bookInfo.style.display = 'block';
    }

    function loadBookCover(isbn) {
      return new Promise((resolve) => {
        const newImage = new Image();
        const imageUrl = `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`;
        console.log('Attempting to load cover from:', imageUrl);

        newImage.onload = function() {
          console.log('Cover image loaded:', {
            height: this.height,
            width: this.width,
            src: this.src
          });
          if (this.height <= 1) {
            // Use default cover if no cover found
            elements.coverImg.src = DEFAULT_COVER;
          } else {
            elements.coverImg.src = this.src;
          }
          elements.coverImg.style.display = 'block';
          resolve();
        };
        newImage.onerror = () => {
          // Use default cover on error
          elements.coverImg.src = DEFAULT_COVER;
          elements.coverImg.style.display = 'block';
          resolve();
        };
        newImage.src = `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`;
      });
    }

    // Main function
    async function fetchBookCover() {
      const isbn = elements.input.value.trim().replace(/-/g, '');

      resetUI();

      if (!isbn) {
        elements.coverImg.style.display = 'none';
        return;
      }

      if (!validateISBN(isbn)) {
        showError('Please enter a valid 10 or 13-digit ISBN');
        return;
      }

      showSpinner();

      try {
        // Fetch metadata and cover separately to handle failures independently
        const bookData = await fetchBookMetadata(isbn);
        await loadBookCover(isbn);
        hideSpinner();

        // Show book info if we have metadata, regardless of cover status
        if (bookData) {
          updateBookInfo(bookData);
        } else {
          showError('No book information found');
        }
      } catch (error) {
        console.error('Error fetching book cover:', error);
        hideSpinner();
        showError('Failed to fetch book information');
        elements.bookInfo.style.display = 'none';
      }
    }

    // Event listeners
    const debouncedFetch = debounce(fetchBookCover, 100);
    elements.input.addEventListener('input', debouncedFetch);
    elements.input.addEventListener('keypress', e => {
      if (e.key === 'Enter') fetchBookCover();
    });

    // Initialize
    elements.input.focus();
  </script>
</body>

</html>